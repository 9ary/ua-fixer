Components.utils.import("resource://gre/modules/Services.jsm");

function isTablet() {
  let sysInfo = Components.classes["@mozilla.org/system-info;1"].
                getService(Components.interfaces.nsIPropertyBag2);
  return sysInfo.get("tablet");
}

const UA_PREF_PREFIX = "general.useragent.override.google.";
const CHROME_PHONE_UA = "Mozilla/5.0 (Linux; Android 6.0; Nexus 5 Build/MRA58N) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/59.0.3071.115 Mobile Safari/537.36";
const CHROME_TABLET_UA = "Mozilla/5.0 (Linux; Android 4.3; Nexus 7 Build/JSS15Q) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/59.0.3071.115 Safari/537.36";
const UA_OVERRIDE = isTablet() ? CHROME_TABLET_UA : CHROME_PHONE_UA;
const GOOGLE_TLDS = [
  "ad",
  "ae",
  "am",
  "as",
  "at",
  "az",
  "ba",
  "be",
  "bf",
  "bg",
  "bi",
  "bj",
  "bs",
  "by",
  "ca",
  "cat",
  "cd",
  "cf",
  "cg",
  "ch",
  "ci",
  "cl",
  "cm",
  "cn",
  "co.ao",
  "co.bw",
  "co.ck",
  "co.cr",
  "co.id",
  "co.il",
  "co.in",
  "co.jp",
  "co.ke",
  "co.kr",
  "co.ls",
  "co.ma",
  "co.mz",
  "co.nz",
  "co.th",
  "co.tz",
  "co.ug",
  "co.uk",
  "co.uz",
  "co.ve",
  "co.vi",
  "co.za",
  "co.zm",
  "co.zw",
  "com",
  "com.af",
  "com.ag",
  "com.ai",
  "com.ar",
  "com.au",
  "com.bd",
  "com.bh",
  "com.bn",
  "com.bo",
  "com.br",
  "com.bz",
  "com.co",
  "com.cu",
  "com.cy",
  "com.do",
  "com.ec",
  "com.eg",
  "com.et",
  "com.fj",
  "com.gh",
  "com.gi",
  "com.gt",
  "com.hk",
  "com.jm",
  "com.kh",
  "com.kw",
  "com.lb",
  "com.ly",
  "com.mt",
  "com.mx",
  "com.my",
  "com.na",
  "com.nf",
  "com.ng",
  "com.ni",
  "com.np",
  "com.om",
  "com.pa",
  "com.pe",
  "com.ph",
  "com.pk",
  "com.pr",
  "com.py",
  "com.qa",
  "com.sa",
  "com.sb",
  "com.sg",
  "com.sl",
  "com.sv",
  "com.tj",
  "com.tr",
  "com.tw",
  "com.ua",
  "com.uy",
  "com.vc",
  "com.vn",
  "cv",
  "cz",
  "de",
  "dj",
  "dk",
  "dm",
  "dz",
  "ee",
  "es",
  "fi",
  "fm",
  "fr",
  "ga",
  "ge",
  "gg",
  "gl",
  "gm",
  "gp",
  "gr",
  "gy",
  "hn",
  "hr",
  "ht",
  "hu",
  "ie",
  "im",
  "iq",
  "is",
  "it",
  "je",
  "jo",
  "kg",
  "ki",
  "kz",
  "la",
  "li",
  "lk",
  "lt",
  "lu",
  "lv",
  "md",
  "me",
  "mg",
  "mk",
  "ml",
  "mn",
  "ms",
  "mu",
  "mv",
  "mw",
  "ne",
  "nl",
  "no",
  "nr",
  "nu",
  "pl",
  "pn",
  "ps",
  "pt",
  "ro",
  "rs",
  "ru",
  "rw",
  "sc",
  "se",
  "sh",
  "si",
  "sk",
  "sm",
  "sn",
  "so",
  "st",
  "td",
  "tg",
  "tk",
  "tl",
  "tm",
  "tn",
  "to",
  "tt",
  "vg",
  "vu",
  "ws",
  "xxx",
];

this.install = function() {};
this.uninstall = function() {};

this.startup = function({webExtension}) {
  for (let tld of GOOGLE_TLDS) {
    Services.prefs.setCharPref(`${UA_PREF_PREFIX}${tld}`, UA_OVERRIDE);
  }
};

this.shutdown = function() {
  for (let tld of GOOGLE_TLDS) {
    Services.prefs.clearUserPref(`${UA_PREF_PREFIX}${tld}`);
  }
};
